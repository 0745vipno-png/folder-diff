# Folder Diff Tool

One-shot, read-only snapshot diff utility for generating
verifiable, auditable change evidence between **two folder snapshots**.

This tool is designed for engineers who want deterministic evidence of:
- What changed
- Where it changed
- How it changed (hash-first)
- Whether the input evidence is trustworthy (integrity audit)

It is **not** a sync tool.  
It is **not** a backup tool.  
It is **not** a monitoring agent.  

It is a deterministic **evidence comparator**.

---

## 1. Design Philosophy

This project follows four principles:

### 1) One-Shot Execution
- Runs once
- Produces immutable artifacts
- Exits immediately

No background processes.  
No hidden state.  
No persistent agents.

---

### 2) Read-Only Guarantee
- Never modifies files
- Never deletes files
- Never performs write operations outside output folder

All operations are observational.

---

### 3) Evidence-First Output
Every execution produces:

- Structured diff report (JSON)
- Tabular diff report (CSV)
- Audit log
- Integrity manifest (SHA-256)

All outputs are traceable and reviewable.

---

### 4) Tamper-Evident Architecture
The system does not attempt to "prevent" modification.

Instead, it ensures that:

> Any modification becomes detectable.

Integrity is enforced through cryptographic fingerprints.

---

## 2. What This Tool Is For

Typical use cases:

- Pre/Post migration verification
- Delivery acceptance evidence
- Incident forensics (what changed between two baselines)
- Backup validation (snapshot A vs snapshot B)
- Release artifact change tracking

If you need:
- Real-time sync
- Continuous monitoring
- Automatic rollback

This tool is not suitable.

---

## 3. Inputs

This tool compares:

- **Snapshot A JSON** (generated by `folder-snapshot`)
- **Snapshot B JSON** (generated by `folder-snapshot`)

Optional (recommended):

- `manifest_A.json`
- `manifest_B.json`

These manifests are used to **audit** whether input snapshots have been altered.

---

## 4. Output Artifacts

Each run generates:


diff_out/
├─ diff_<run_id>.json
├─ diff_<run_id>.csv
├─ audit_<run_id>.log
└─ manifest_<run_id>.json



### Diff Report (JSON)
Full structured representation, including:

- Header (mode, tool version, run id)
- Integrity audit status for inputs
- Summary counts
- Detailed diff records

### Diff Report (CSV)
Excel-friendly change list:

- type (ADDED / REMOVED / MODIFIED)
- rel_path
- changed_fields

### Audit Log
Append-only execution journal.

Records:
- Input loading
- Integrity verification status
- Diff execution summary

### Manifest
SHA-256 fingerprints for all output artifacts (diff json/csv + audit log).

Used for integrity verification.

---

## 5. Installation

Requirements:

- Python 3.9+
- Windows / Linux / macOS

No third-party dependencies.

---

## 6. Usage

### Basic

```bat
run.bat --a ".\outA\snapshot_20260225_101010.json" --b ".\outB\snapshot_20260226_101010.json" --out ".\diff_out"


With Integrity Audit (Recommended)
run.bat ^
  --a ".\outA\snapshot_20260225_101010.json" ^
  --manifest-a ".\outA\manifest_20260225_101010.json" ^
  --b ".\outB\snapshot_20260226_101010.json" ^
  --manifest-b ".\outB\manifest_20260226_101010.json" ^
  --out ".\diff_out"
  
  
  7. Diff Policy (SMART Mode)

This tool intentionally uses hash-first comparison.

If both entries have sha256

Compare sha256

Any mismatch => MODIFIED

If sha256 is missing (fallback)

Compare size

Compare mtime_epoch

Any mismatch => MODIFIED

This avoids false negatives when hashes exist,
while remaining usable when hashing is disabled in snapshots.

8. Scope Policy

This tool compares files only.

Directory entries are intentionally ignored to:

reduce noise

increase performance

focus on meaningful content differences

9. Exit Codes
Code	Meaning
0	No differences, integrity OK/UNKNOWN
2	Differences found OR integrity audit FAILED
1	Fatal execution failure

Note:

UNKNOWN integrity status means manifest was not provided or invalid.

FAILED integrity status means snapshot hash does not match manifest.

10. Integrity Verification

This tool supports input integrity audit:

If manifest is provided:

tool recomputes snapshot SHA-256

compares against manifest recorded value

If mismatch occurs:

tool continues (audit mode)

report marks integrity as FAILED

exit code becomes 2

This preserves evidence while clearly flagging trust issues.

11. Non-Goals

This project intentionally avoids:

GUI

Background daemons

Cloud integration

Auto-remediation

Auto-rollback

AI-based inference

Simplicity is a feature.

12. Intended Audience

This tool is designed for:

Platform Engineers

SREs

Infrastructure Engineers

System Architects

Technical Auditors

If you prioritize:

Convenience over traceability
Speed over evidence

This project may not fit your workflow.

13. License

MIT License

14. Author's Note

Most system failures originate from human assumptions,
not technical limitations.

This tool exists to reduce ambiguity,
not to automate decisions.

It provides evidence.

You provide judgment.